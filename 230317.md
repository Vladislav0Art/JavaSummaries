##  Внутренние и вложенные классы

```java
// Outer class
class A {

    B z1 = new B();
    B z2 = this.new B(); // эти 2 строки эквивалентные

    int foo;
    /*
    1. Внутренние (Inner) классы
    2. Полное название A.B
    3. Внутри такого класса неявно хранится ссылка на экземпляр внешнего класса A.this
    4. Когда создаём переменную внутреннего класса - мы должны явно привязать его к экземпляру внешнего класса
    5. Нельзя заводить статические поля и статические методы (потому что можно написать во внешнем классе и будет такое же поведение, поэтому запретили)
    */
    class B {
        A.this.foo;
        foo; // проверяем есть ли foo, если нет - то ищем в внешнем классе и т.д.
    }

    /*
    1. Вложенные (Nested) классы
    2. Полное название класса A.C, при компиляции A.C.class
    3. Тут ничего привязывать к внешнему классу не нужно
    4. Можно заводить статические поля и методы
    */
    static class C {
        // если есть экземпляр A a
        // то писать a.foo можно, даже если foo был private
    }
}
```

Зачем такой механизм есть:
1. Потому что в `Java` нет `friend` - внутренние классы. Пример внутреннего класса - итератор.
1. Причины писать вложенные класс - инкапсуляция кода и явная ассоциация с классом, например `Map.Entry`.

Зачем ещё может быть нужно:
1. Например, мы хотим написать тесты, которые проверяют корректность приватных методов. Поэтому можно писать тесты как вложенные классы.

```java
class A {
    static class C {
        public static void main(String[] args) {
            A a = ...;
            // тут напишем тесты
        }
    }
}
```

У нас скомпилируется `A.class` и `A.C.class`, а потом, когда мы потестировали - можем выпилить `A.C.class` из сборки и никто и никогда не узнает, что у нас был такой вложенный класс

## Анонимные классы

Анонимный класс - когда внутри функции хотим создать его класс и создать его экземпляр.

Можем реализовать только 1 интерфейс или отнаследоватся только от одного класса.

```java
Shape x = new Shape() { // equiv to class ... extends Shape
    int y = ...
    void foo() {
        ...
    }
    // это анонимный класс
    // нет имени, нет конструктор, его замена - секция инициализации.
    // компилируется такая штука в A.$1.class
    
}
```